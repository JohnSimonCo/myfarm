<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<%@ Register Package="Delaval.VMSController.WebControls." TagPrefix="wctrl" %>
<%@ Register Package="Delaval.VMSController.WebControlsAsp." TagPrefix="" %>
<%@ Register Package="Delaval.VMSController.WebControlsAsp." TagPrefix="asp" %>
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
	<head>
		<title>Time between milkings</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="simpleGraph.js"></script>
		<script type="text/javascript">
			if(typeof JsSerilz=='undefined'){function JsSerilz(delimiter,data){var escapeChar='\\',index=0,nextEscape;if(data!=null){index=0;if((nextEscape=data.indexOf(escapeChar))<0)nextEscape=data.length+1}else{this.d=""};this.serialize=function(){var i=-1;while(++i<arguments.length){o=arguments[i];if(o!=null)this.d+=o.toString().replace(/\u005c/g,"\\\\").replace(delimiter,escapeChar+delimiter)+delimiter;else this.d+=delimiter;}};this.serialize=function(){var i=-1;while(++i<arguments.length){o=arguments[i];if(o!=null)this.d+=o.toString().replace(/\u005c/g,"\\\\").replace(delimiter,escapeChar+delimiter)+delimiter;else this.d+=delimiter;}};this.getString=function(){var rVal,i,ii,ifrom=index;if(ifrom>=data.length)return null;i=data.indexOf(delimiter,ifrom);if(i>nextEscape){rVal=data.substring(ifrom,nextEscape)+data.charAt(nextEscape+1);index=nextEscape+2;if((nextEscape=data.indexOf(escapeChar,nextEscape+2))<0)nextEscape=data.length+1;if(data.charAt(index)==delimiter)index++;else rVal+=this.getString();}else{rVal=data.substring(ifrom,i);index=i+1;}return(rVal.length==0)?null:rVal;};this.getInt=function(){return parseInt(this.getString(),10)};this.getRest=function(){return data.substring(index,data.length)};this.hasMore=function(){return index<data.length};this.getData=function(){return this.d};this.getInputString=function(){return data}}}
			if (typeof xmlhttp=='undefined'){var xmlhttp=false;var ajaxfkn;function ajax(param,fkn){ajaxfkn=fkn;if(!xmlhttp)try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}catch(E){xmlhttp=false;}}if(!xmlhttp&&typeof XMLHttpRequest!='undefined')xmlhttp=new XMLHttpRequest();if(xmlhttp){var deli=document.URL.indexOf('?')>=0?'&':'?';xmlhttp.open("GET",document.URL+deli+param,true);xmlhttp.onreadystatechange=ajaxCallback;xmlhttp.send(null);}return typeof(xmlhttp)=='object';}function ajaxCallback(){if((xmlhttp.readyState==4)&&(xmlhttp.status==200))if (typeof(ajaxfkn)=='string'){var a=ajaxfkn+"('"+xmlhttp.responseText.replace(/\u0027/g,"&#39;").replace(/\u0022/g,"&#34;")+"');";eval(a);}else ajaxfkn(xmlhttp.responseText);}}
	var pg = {
		resize:	function(){
			pg.canvas.width = window.innerWidth - 20;
			pg.canvas.height = window.innerHeight - 20;
			sGraph.paint(pg.canvas);
		},
		pData:	function(d){
			this.val=d.getInt()/100;
			this.max=d.getInt()/100;
			this.min=d.getInt()/100;
		},
		init:	function(d){
			pg.canvas=document.getElementById('myCanvas');
			pg.now=d.getInt()*3600000;
			pg.tb=d.getInt()*3600000;
			var cnt=d.getInt(),i=-1;
			pg.data=[];
			while(++i<cnt)pg.data.push(new pg.pData(d));
			sGraph.Clear('#e8d898','#f4f4f4','d/m');
			sGraph.setFont('italic bold 20px sans-serif', 20);
			sGraph.addLine('#ffc0c0',1);
			i=cnt;
			while(--i>=0)sGraph.addPoint(pg.now-pg.tb*i,pg.data[i].max);
			sGraph.addLine('#00ff00',1);
			i=cnt;
			while(--i>=0)sGraph.addPoint(pg.now-pg.tb*i,pg.data[i].min);
			sGraph.addLine('#8080ff',1);
			i=cnt;
			while(--i>=0)sGraph.addPoint(pg.now-pg.tb*i,pg.data[i].val*2);
			i=cnt;
			var dd=pg.now-pg.tb*(cnt-1),ds=parseInt(dd/86400000)*86400000+new Date().getTimezoneOffset()*60000+86400000,di=ds;
			var aver=[],sum,cc;
			while(i>0){
				sum=cc=0;
				while(i>0&&dd<di){
					sum+=pg.data[--i].val;
					cc++;
					dd+=pg.tb;
				}
				aver.push(sum*2/cc);
				di+=86400000;
			}
			sGraph.addLine('#0000ff',4);
			i=-1;
			ds-=43200000;
			while(++i<aver.length)sGraph.addPoint(ds+i*86400000,aver[i]);

			dd=pg.now-pg.tb*(cnt-1);ds=parseInt(dd/86400000)*86400000+new Date().getTimezoneOffset()*60000+86400000;di=ds;aver=[];i=cnt;
			while(i>0){
				sum=cc=0;
				while(i>0&&dd<di){
					sum+=pg.data[--i].max;
					cc++;
					dd+=pg.tb;
				}
				aver.push(sum/cc);
				di+=86400000;
			}
			sGraph.addLine('#ff0000',2);
			i=-1;
			ds-=43200000;
			while(++i<aver.length)sGraph.addPoint(ds+i*86400000,aver[i]);

			if(sGraph.getYmax()>20)sGraph.setYmax(24);
			pg.resize();
			var now=new Date().getTimezoneOffset() * 60000;
			var slut=0;
			slut++;
		}
	};
		</script>
</head>
	<body onresize="pg.resize()">
		<canvas id="myCanvas">This browser does not support the canvas tag</canvas>
	    <form id="form1" runat="server">
			<script type="text/javascript">
				pg.init(new JsSerilz('$',document.getElementById("q").value));
			</script>
		</form>
	</body>
</html>
